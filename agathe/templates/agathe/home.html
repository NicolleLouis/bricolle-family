{% extends 'agathe/base.html' %}

{% block content %}
    {% load feeding_colors %}
    <h2 class="mb-4" >Accueil</h2>
    <div class="card p-4 shadow-sm mb-4" style="background-color: {{ last_pit_stop.start_date|default_if_none:''|feeding_color }};">
        <h5>Dernier pit stop</h5>
        {% if last_pit_stop %}
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <ul>
                        <li>{{ last_pit_stop.start_date|date:"d/m/Y H:i" }}</li>
                        <li>Quantité : <strong>{{ last_pit_stop.quantity }} mL</strong></li>
                        {% if last_pit_stop.comment %}
                        <li>Commentaire : {{ last_pit_stop.comment }}</li>
                        {% endif %}
                    </ul>
                </div>
                <div>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pitStopModal">Add new</button>
                </div>
            </div>
        {% else %}
            <p>Aucun pit stop enregistré.</p>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pitStopModal">Add new</button>
        {% endif %}
    </div>
    <div class="card p-4 shadow-sm" style="{% if diaper_overdue %}background-color: lightcoral;{% endif %}">
        <h5>Dernier changement de couche</h5>
        <div class="d-flex justify-content-between align-items-center">
            <div>
                {% if last_diaper_change %}
                    <ul>
                        <li>{{ last_diaper_change.date|date:"H:i" }}</li>
                    </ul>
                {% else %}
                    <p>Aucun changement de couche enregistré.</p>
                {% endif %}
            </div>
            <div>
                <form method="post" action="{% url 'agathe:diaper_change_quick' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Ajouter</button>
                </form>
            </div>
        </div>
    </div>
    <div class="card p-4 shadow-sm mt-4" style="background-color: {% if vitamin_today %}lightgreen{% else %}lightcoral{% endif %};"> 
        <h5>Vitamine</h5>
        {% if vitamin_today %}
            <p>Vitamine prise aujourd'hui.</p>
        {% else %}
            <p>Aucune vitamine enregistrée aujourd'hui.</p>
        {% endif %}
        <form method="post" action="{% url 'agathe:vitamin_intake' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Prendre maintenant</button>
        </form>
    </div>
    <div class="card p-4 shadow-sm mt-4" style="background-color: {% if bath_recent %}lightgreen{% else %}lightcoral{% endif %};"> 
        <h5>Dernier bain</h5>
        {% if last_bath %}
            <p>{{ last_bath.date|date:"d/m/Y" }}</p>
        {% else %}
            <p>Aucun bain enregistré.</p>
        {% endif %}
        <form method="post" action="{% url 'agathe:bath' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Enregistrer maintenant</button>
        </form>
    </div>
    <p>Agathe a {{ age_months }} mois et {{ age_days }} jours.</p>

    <div class="modal fade" id="pitStopModal" tabindex="-1" aria-labelledby="pitStopModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pitStopModalLabel">Nouveau pit stop</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post">
                    {% csrf_token %}
                    <div class="modal-body">
                        {{ pit_stop_form.non_field_errors }}
                        <div class="mb-3">
                            {{ pit_stop_form.start_date.label_tag }}
                            {{ pit_stop_form.start_date }}
                            {{ pit_stop_form.start_date.errors }}
                        </div>
                        <div class="mb-3">
                            {{ pit_stop_form.quantity.label_tag }}
                            {{ pit_stop_form.quantity }}
                            {{ pit_stop_form.quantity.errors }}
                        </div>
                        <div class="mb-3">
                            {{ pit_stop_form.comment.label_tag }}
                            {{ pit_stop_form.comment }}
                            {{ pit_stop_form.comment.errors }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    {% if pit_stop_form.errors %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = new bootstrap.Modal(document.getElementById('pitStopModal'));
            modal.show();
        });
    </script>
    {% endif %}
{% endblock %}
